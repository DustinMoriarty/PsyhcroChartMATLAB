function f = psychro(patm)%% Plotting the Simplified Psychrometric Chart% Dustin Moriarty 02/18/2013% Based on Code By Izzi Urieli 2/27/2008% % If you need exact data, then this plot is not for you.  On the other% hand, if you simply want to plot the psychrometrics of an AC% system, this may be what you need.% Arguments% patm     pressure%Data% tpg = dlmread('t_pg','\t'); % saturation temp/pressure% t = tpg(:,1); % temperature (C)% pg = tpg(:,2); % saturation vapor pressure (kPa)t = 0:1:51; %temperature (C)t = t';pg = zeros(length(t),1)for i = 1:length(t)    pg(i) = SaturationPressure(t(i) + 273.15)*1e-3;endrair = 0.287; % gas constant of air (kJ/kg.K)wg = 622*pg./(patm-pg); % saturation specific humidityf = figure('Position',[1 1 1200 800] )plot(t,wg,'r-');hold;grid onenthalpyrelativehumidity(t,pg)specificvol    function relativehumidity(t,pg)        for phi = 0.1:0.1:0.9, % phi = relative humidity 10% - 40%            w = 622*phi*pg./(patm-phi*pg);            plot(t,w)            text(t(30),w(30),sprintf('%1.0f %%',phi*100),'color','blue',...                'backgroundcolor','white','rotation',...                atan2(w(30)-w(29),t(30)-t(29))*180/pi);        end        phi = 0.1;        w = 622*phi*pg./(patm-phi*pg);        text(t(30),w(30)+1,sprintf('Relative Humidity'),'color','blue',...            'backgroundcolor','white','rotation',...            atan2(w(30)-w(29),t(30)-t(29))*180/pi,'HorizontalAlignment','center');        end    function specificvol        % specific volume and enthalpy/wet-bulb-temp        % tpg1 = dlmread('t_pg1','\t');        % t1 = tpg1(:,1); % saturation temperature (C)        % pg1 = tpg1(:,2); % saturation pressure (kPa)        t1 = 5:5:35;        t1 = t1';        pg1 = zeros(length(t1),1)        for i = 1:length(t1)            pg1(i) = SaturationPressure(t1(i) + 273.15)*1e-3;        end        wg1 = 622*pg1./(patm-pg1); % saturation specific humidity        % specific volume of dry air (cubic m/kg dry air) (green)        vol = rair.*(t1+273)./(patm-pg1) % specific vol at saturation        tv0 = patm*vol/rair-273; % air temperature at zero humidity        for i = 1:7,            plot([t1(i),tv0(i)],[wg1(i),0],'g-')            text((t1(i) - tv0(i))/wg1(i)*(.8*wg1(i))+tv0(i),(.8*wg1(i)),...                sprintf('%0.2f m^3/kg',vol(i)),'color','green','backgroundcolor',...                'white','rotation',atan2(-wg1(i),tv0(i)-t1(i))*180/pi)        end            text((t1(2) - tv0(2))/wg1(2)*(.9*wg1(2))+tv0(2) + 1,(.9*wg1(2)),...                'Specific Volume','color','green','backgroundcolor',...                'white','rotation',atan2(-wg1(2),tv0(2)-t1(2))*180/pi)        %% wet bulb temperature and enthalpy lines (red)        h = t1 + 2.5*wg1 % enthalpy (kJ/kg-dry-air)        t0 = h; % temperature at zero humidity         for i = 1:6,            plot([t1(i),t0(i)],[wg1(i),0],'r-')            text((t1(i) - t0(i))/wg1(i)*(wg1(i))+t0(i),(wg1(i)),...            sprintf('%1.0f ^oC',t1(i)),'color','red','backgroundcolor',...            'white','rotation',atan2(-wg1(i),t0(i)-t1(i))*180/pi,...            'HorizontalAlignment','right','VerticalAlignment','Top')        end        text((t1(3) - t0(3))/wg1(3)*(wg1(3))+t0(3),(wg1(3)),...            'Wet Bulb Temperature','color','red','backgroundcolor',...            'white','rotation',atan2(-wg1(3),t0(3)-t1(3))*180/pi,...            'HorizontalAlignment','Center','VerticalAlignment','Bottom')    end    function enthalpy%% enthalpy axis and enthalpy lines (black)                for h = 10:10:110, % enthalpy (kJ/kg-dry-air)            t0 = h; % temperature at zero humidity            t1 = (h - 12.5)/3.5; % temperature on enthalpy axis            w1 = t1 + 5; % specific humidity on enthalpy axis            plot([t0,t1],[0,w1],'k-');            if h>10 & h<=100            text(t1,w1,...                sprintf('%1.0f kJ/kg',h),'color','black','backgroundcolor',...                'white','rotation',atan2(-w1,-t1+t0)*180/pi,...                'HorizontalAlignment','center');            end            if h ==30                text(t1,w1+.3,...                'Specific Enthalpy','color','black','backgroundcolor',...                'white','rotation',atan2(-w1,-t1+t0)*180/pi,'HorizontalAlignment',...                'center','VerticalAlignment','Bottom');            end        end    endfunction p = SaturationPressure(T)    %% Saturation Pressure of Water Per ASHRAE 2009 F1.2    % Author: Dustin Moriary    %    % Arguments    % T     Temperature (K)    if T>=173.15 && T < 273.15        C1 = -5.6745359e3;        C2 = 6.3925247;        C3 = -9.6778430e-3;        C4 = 6.2215701e-7;        C5 = 2.0747825e-9;        C6 = -9.484024e-13;        C7 = 4.1635019;        p = exp(C1/T + C2 + C3*T + C4*T^2 + C5*T^3 + C6*T^4 + C7 * log(T));    elseif T>= 273.15 && T< 473.15        C8 = -5.8002206e3;        C9 = 1.3914993;        C10 = -4.8640239e-2;        C11 = 4.1764768e-5;        C12 = -1.4452093e-8;        C13 = 6.5459673;        p = exp(C8/T+C9+C10*T+C11*T^2+C12*T^3+C13*log(T));    else        p = NaN;    endendaxis([0,50,0,32])title(sprintf('Psychrometric Properties of Moist Air At %3.1f kPa', patm))xlabel('Dry Bulb Temperature (^oC)')ylabel('Specific Humidity  (g_{vap}/kg_{dry air})')end